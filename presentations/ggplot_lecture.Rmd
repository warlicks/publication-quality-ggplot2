---
title: "ggplot()"
author: "Amanda Warlick & Sean Warlick"
date: " `r Sys.Date()`"
fontsize: 10pt
output:
  slidy_presentation: default
  # powerpoint_presentation: default
  ioslides_presentation: default
  html_document: default
---

<style>
slides > slide {
  overflow-x: auto !important;
  overflow-y: auto !important;
}
</style>

```{r setup, include=FALSE, echo = F}

knitr::opts_chunk$set(warning = FALSE,
                      message = FALSE,
                      echo = TRUE,
                      tidy = FALSE,
                      fig.height = 4.5,
                      fig.width = 7,
                      fig.align = 'center', 
                      tidy.opts = list(width.cutoff=10),
                      width = 10)

library(dplyr)
library(ggplot2)
library(here)


data <- read.csv(here('data', 'PiGu_exDat.csv'),
                 header = TRUE,
                 stringsAsFactors = FALSE)

data_means <- data %>%
  group_by(year, mo, site) %>%
  summarize(temp = mean(temp, na.rm = T),
            count = mean(PG_count),
            tide = mean(v))

```

## Benefits of ggplot()

- Can do everything (and more?!) that base R plotting can do
- Tidyverse - streamlined, quick modifications, data-subsetting
- Many extensions, color themes, and (easy) customization options

## The Basics

- Data
- Plot type: geom_*
- Aesthetics: aes(x, y, grouping)
- Scales: axes, colors
- Appearance using theme()
- Customizations: axes, fonts, legends

## The Basics

- Data
    - Dataframes by columns and grouping variables  
    - Seabird counts by site, year, month, yday and temperature and tide   
    - Covariates: temperature, tide height, minutes since high tide  

```{r data, echo = TRUE, size = 1}

head(data)

```

## Scatterplot

- Plot type
    - Controlled by 'geom_*()' argument

```{r basic scatter}

ggplot(data, aes(yday, temp)) + 
  geom_point()

```

## Customize
- Axis labels  
- aes(): change color OUTSIDE aes() to manually designate

```{r custom 1}

ggplot(data, aes(yday, temp)) + 
  geom_point(color = 'blue') +
  xlab('Year Day') +
  ylab('Temperature') 
```

## Customize
- Axis labels  
- aes(): change color INSIDE aes() to group by variable

```{r custom 2}

ggplot(data, aes(yday, temp)) + 
  geom_point(aes(color = factor(mo))) +
  xlab('Year Day') +
  ylab('Temperature')
```

## Customize 
- Change colors, sizes, and legend labels
- Overlapping points: alpha for transparency or position = 'jitter'

```{r custom 3}

ggplot(data, aes(yday, temp)) + 
      #try grouping color by year or site
  geom_point(aes(color = factor(mo))) + 
  #try adding size = year inside aes()
  # geom_point(aes(color = factor(mo), size = year, alpha = 0.2), show.legend = F) +
  xlab('Year Day') + 
  ylab('Temperature')

  
```

## Other plot types
- Boxplot

```{r boxplot}

ggplot(data, aes(factor(mo), temp)) + 
  geom_boxplot(aes(color = factor(mo))) + #try geom_violin()!
  xlab('Month') + ylab('Temperature') 
```

## Other plot types
- Histogram
```{r histogram}
data %>% 
  ggplot(aes(PG_count)) +
  geom_histogram() 
```

## Faceting
- Common display options include moving the strip title, having differing y-axis scales, ncol/nrow
- Facet_wrap versus facet_grid

```{r facets}

ggplot(data, aes(factor(mo), temp)) + 
  geom_boxplot(aes(color = factor(mo))) + 
  xlab('Month') +
  ylab('Temperature') +

  facet_wrap(~year)

```


## Multiple geom layers
- Think beyond point + line

```{r }
data_means %>% 
  filter(site == 'Cliffside') %>% 
  ggplot(aes(factor(year), temp, col = factor(mo), group = factor(mo))) + 
  geom_point() + 
  geom_line() +
  xlab('') + 
  ylab('Temperature')

```

## Multiple geom layers
```{r hist & density}
data %>% 
  ggplot(aes(PG_count)) +
  geom_histogram() + 
  geom_density()
```

## Stat layers

- geom_smooth()
  - Display or turn of SE band, 'lm' versus 'loess' method

```{r }
data_means %>% 
  filter(site == 'Cliffside') %>%  #look at different sites, or facet by site below
  ggplot(aes(factor(year), temp, col = factor(mo), group = factor(mo))) + 
  geom_point(size = 0.8) + 
  geom_line(linetype = 'dashed') + #se = F, method = 'lm'
  geom_smooth(aes(fill = factor(mo)), alpha = 0.2, show.legend = F) +
  #or, instead, use geom_ribbon() if have own 95% CI
  #geom_ribbon(aes(mean = mean, ymin = lower, ymax = upper)) +
  xlab('') + 
  ylab('Temperature')
  # facet_wrap(~site)

```

## Stat layers
- Example of varied y-axis scale by facet
```{r }

ggplot(data_means, 
       aes(tide, count, group = year)) + 
  geom_point(size = 0.8) +
  # geom_line(linetype = 'dashed') + #se = F, method = 'lm'
  geom_smooth(method = 'lm') +
  xlab('Tide Height') + ylab('Seabird count') +
  facet_wrap(~year, scales = 'free_y')

```

## Complications

- Sometimes things get ugly with multiple data sources and geoms
    - Using inherit.aes = F, show.legend
    - Being explicit with data = X, aes(), color, etc.




  
## Exercise 1: explore density plots

- [This example](https://wilkelab.org/practicalgg/articles/health_status.html)


## Exercise 2: Make your own
- Look at the diversity of types of ggplots you can make, and create 1-2 plots using the seabird data that involve other geoms




## Resources

The [ggplot2 cheatsheet](https://github.com/rstudio/cheatsheets/blob/master/data-visualization-2.1.pdf)

Examples of manipulating [everything](https://cedricscherer.netlify.com/2019/08/05/a-ggplot2-tutorial-for-beautiful-plotting-in-r/)

A [master list](http://r-statistics.co/Top50-Ggplot2-Visualizations-MasterList-R-Code.html) of (sometimes ugly, but mind-opening) ggplots

Helpful outline of functionality per [specific geoms](https://ggplot2.tidyverse.org/reference/)

Examples from [R for Data Science](https://r4ds.had.co.nz/data-visualisation.html)

[Nice color palettes](https://ggplot2.tidyverse.org/reference/scale_brewer.html)

[Practical ggplot2](https://wilkelab.org/practicalgg/) has a great bunch of examples from the author of cowplot and one of the ggplot developers of going step-by-step from the basic plot to a publication-quality graphic

[ggplot2 book](https://ggplot2-book.org/)

[R Graphics Cookbook](https://r-graphics.org/)






